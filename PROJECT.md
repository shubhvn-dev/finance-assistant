# PROJECT.md — AI Cold Call Trainer for Financial Advisors

> This file defines WHAT we're building, WHY, and the boundaries.
> Source of truth for scope. If it's not here, we're not building it (yet).

---

## Problem

Financial advisors need to make cold calls to grow their book of business, but:
- They have **no safe place to practice** — every bad call burns a real prospect.
- Traditional roleplay with colleagues is awkward, inconsistent, and hard to schedule.
- There's **no structured feedback loop** — advisors don't know *specifically* what they're doing wrong (weak opener? bad objection handling? no close?).

**Result:** Advisors avoid cold calling, or they do it poorly, wasting high-quality leads.

---

## User

**Primary:** Financial advisors (independent RIAs, wirehouse reps, insurance agents) who actively prospect via phone. Typically 2–15 years experience. Comfortable with technology but not developers.

**Secondary:** Sales managers / team leads who want to onboard new reps with structured practice before hitting live phones.

---

## Demo Path (Start → Wow → End)

```
1. Advisor logs in → sees clean dashboard with session history
2. Clicks "New Call" → picks a prospect persona (e.g., "Skeptical Retiree", "Busy Executive")
3. Persona card shows: name, age, net worth range, financial situation, likely objections
   (pulled from Finny's prospect data layer)
4. Advisor clicks "Start Call" → ElevenLabs voice activates, AI prospect says "Hello?"
5. Advisor delivers their pitch — AI pushes back with realistic objections
   ("I already have a guy", "Send me something in the mail", "How'd you get my number?")
6. Conversation runs 5–6 turns → AI gracefully ends the call
7. ✨ WOW MOMENT: Comprehensive scorecard appears instantly:
   - Opener effectiveness (1-10)
   - Objection handling (1-10)
   - Tone & rapport (1-10)
   - Close attempt quality (1-10)
   - Overall grade (A–F)
   - Verbatim quotes with inline feedback ("Here you fumbled — try X instead")
   - One key thing to improve next time
8. Advisor sees their score added to session history → trend line shows improvement
```

---

## Must-Have (v1 — MVP)

| # | Feature | Description |
|---|---------|-------------|
| 1 | Voice conversation | Real-time voice roleplay via ElevenLabs Conversational AI (WebSocket) |
| 2 | AI prospect personas | 4 distinct personas with unique objection patterns, powered by Anthropic Claude |
| 3 | Prospect data grounding | Personas enriched with realistic financial prospect data via Finny |
| 4 | Turn management | Conversations capped at 5–6 turns with natural ending |
| 5 | Scorecard generation | Post-call scoring rubric generated by Claude (opener, objections, tone, close) |
| 6 | Session persistence | Full conversation history + scorecards persisted via Blaxel |
| 7 | Session history dashboard | List of past sessions with scores, timestamps, and trend indicators |
| 8 | Auth | Basic auth (email/password or OAuth) — just enough to tie sessions to a user |

---

## Nice-to-Have (v2+)

- Custom persona builder (advisor defines their own prospect type)
- Team/org accounts with manager dashboards
- A/B script testing (try two openers, compare scores)
- Leaderboard for competitive teams
- Export session transcripts as PDF
- CRM integration (Salesforce, Wealthbox)
- Mobile app (React Native)
- Telephony integration (practice on actual phone via Twilio/ElevenLabs outbound)

---

## Stack Decisions

| Layer | Technology | Rationale |
|-------|-----------|-----------|
| **Frontend** | Next.js 14+ (App Router), TypeScript, Tailwind CSS | SSR for dashboard, client components for voice UI, fast iteration |
| **Voice** | ElevenLabs Conversational AI 2.0 (WebSocket API) | Sub-100ms latency, state-of-the-art turn-taking, multi-character support |
| **AI / Persona + Scoring** | Anthropic Claude (via API) | Best-in-class instruction following for persona roleplay + structured scoring output |
| **Prospect Data** | Finny API | Real financial prospect data (demographics, net worth signals, money-in-motion events) to ground personas in reality |
| **Persistence / Hosting** | Blaxel | Serverless agent hosting with persistent sandboxes, auto-scale-to-zero, built-in observability |
| **Database** | PostgreSQL (via Blaxel or Supabase) | Session history, user accounts, scorecard storage |
| **Auth** | NextAuth.js (or Clerk) | Fast setup, OAuth + credentials support |
| **Testing** | Vitest + Playwright | Unit tests + E2E for critical flows |

---

## Folder Structure

```
finance-assistant/
├── app/                        # Next.js App Router
│   ├── (auth)/                 # Login / signup pages
│   ├── dashboard/              # Session history + trends
│   ├── session/
│   │   ├── [id]/               # Individual session review + scorecard
│   │   └── new/                # Persona selection + voice call UI
│   ├── api/
│   │   ├── session/            # CRUD for sessions
│   │   ├── scorecard/          # Trigger Claude scoring
│   │   ├── persona/            # Fetch persona configs + Finny data
│   │   └── webhooks/           # ElevenLabs event hooks
│   └── layout.tsx
├── lib/
│   ├── anthropic.ts            # Claude client — persona prompts + scoring
│   ├── elevenlabs.ts           # ElevenLabs WebSocket manager
│   ├── finny.ts                # Finny API client
│   ├── blaxel.ts               # Blaxel persistence client
│   ├── scoring.ts              # Scorecard rubric + grade calculation
│   ├── personas.ts             # Persona definitions + prompt templates
│   └── db.ts                   # Database queries
├── components/
│   ├── VoiceCallUI.tsx         # Mic controls, waveform, turn indicator
│   ├── PersonaCard.tsx         # Prospect persona preview card
│   ├── Scorecard.tsx           # Post-call scorecard display
│   ├── SessionList.tsx         # Dashboard session history
│   └── TrendChart.tsx          # Score improvement over time
├── types/
│   └── index.ts                # Shared TypeScript types
├── prompts/
│   ├── persona-system.md       # System prompt template for prospect personas
│   └── scoring-system.md       # System prompt template for scorecard generation
├── public/
├── tests/
├── .env.example
├── CLAUDE.md                   # ← You are here (AI operating rules)
├── PROJECT.md                  # ← This file (project spec)
└── package.json
```

---

## API Contracts

### POST `/api/session`
Create a new practice session.
```json
// Request
{ "userId": "string", "personaId": "string" }

// Response
{ "sessionId": "string", "persona": { "name": "string", "background": "string", "objections": ["string"] }, "status": "created" }
```

### POST `/api/session/[id]/turn`
Record a conversation turn.
```json
// Request
{ "speaker": "advisor" | "prospect", "text": "string", "audioUrl": "string | null", "turnNumber": 1 }

// Response
{ "turnId": "string", "turnNumber": 1, "status": "recorded" }
```

### POST `/api/scorecard`
Generate scorecard after session ends.
```json
// Request
{ "sessionId": "string" }

// Response
{
  "sessionId": "string",
  "scores": {
    "opener": 7,
    "objectionHandling": 5,
    "tone": 8,
    "close": 4,
    "overall": "C+"
  },
  "feedback": [
    { "turnNumber": 2, "quote": "string", "comment": "string", "suggestion": "string" }
  ],
  "keyImprovement": "string",
  "generatedAt": "ISO-8601"
}
```

### GET `/api/persona`
List available personas.
```json
// Response
[
  {
    "id": "skeptical-retiree",
    "name": "Robert Chen",
    "age": 67,
    "profile": "Recently retired engineer, $1.2M 401k rollover, skeptical of advisors",
    "primaryObjections": ["I already have a financial advisor", "I don't trust salespeople"],
    "finnyEnriched": true
  }
]
```

### GET `/api/session/history?userId=X`
Fetch session history for dashboard.
```json
// Response
[
  {
    "sessionId": "string",
    "personaId": "string",
    "personaName": "string",
    "date": "ISO-8601",
    "overallGrade": "B-",
    "scores": { "opener": 7, "objectionHandling": 6, "tone": 8, "close": 5 }
  }
]
```

---

## Data Model

```
┌──────────────┐     ┌──────────────────┐     ┌──────────────┐
│    users      │────│     sessions      │────│   turns       │
├──────────────┤     ├──────────────────┤     ├──────────────┤
│ id (PK)       │     │ id (PK)           │     │ id (PK)       │
│ email         │     │ user_id (FK)      │     │ session_id(FK)│
│ name          │     │ persona_id        │     │ speaker       │
│ created_at    │     │ started_at        │     │ text          │
└──────────────┘     │ ended_at          │     │ audio_url     │
                      │ status            │     │ turn_number   │
                      └──────────────────┘     │ created_at    │
                              │                 └──────────────┘
                              │
                      ┌──────────────────┐
                      │   scorecards      │
                      ├──────────────────┤
                      │ id (PK)           │
                      │ session_id (FK)   │
                      │ opener_score      │
                      │ objection_score   │
                      │ tone_score        │
                      │ close_score       │
                      │ overall_grade     │
                      │ feedback_json     │
                      │ key_improvement   │
                      │ generated_at      │
                      └──────────────────┘
```

---

## Definition of Done

A feature is "done" when:
1. **It works end-to-end** — not just the happy path, but handles errors gracefully
2. **It's tested** — unit test for logic, E2E test for critical user flows
3. **It's typed** — no `any` types, no `// @ts-ignore`
4. **It's styled** — matches the design system, responsive on desktop (mobile is v2)
5. **It's persisted** — if it creates data, that data survives a page refresh
6. **It's documented** — API endpoints have JSDoc, complex logic has a one-line comment explaining *why*
7. **It's reviewed** — at least one substantive review comment addressed

---

## What NOT to Build (Scope Guardrails)

| Don't Build | Why |
|-------------|-----|
| Mobile app | Desktop-first MVP. Advisors cold call from their desk. |
| Real phone integration | Voice happens in-browser via ElevenLabs WebSocket. No Twilio yet. |
| Custom persona builder | Ship with 4 hardcoded personas. Validate demand first. |
| CRM sync | Out of scope for v1. Advisors can screenshot their scorecard. |
| Team/org features | Single-user MVP. No admin dashboards, no team rollups. |
| Payment/billing | Free during beta. Monetization is a v2 concern. |
| Transcript export | Nice-to-have. Not blocking launch. |
| AI coaching chat | The scorecard IS the coaching. No separate chat interface. |
| Voice cloning | Use ElevenLabs stock voices. No custom voice training. |
| Multi-language | English only for v1. |

---

## Open Questions

- [ ] Finny API access: Do we have API credentials? What's the rate limit? What fields are available per prospect?
- [ ] ElevenLabs agent config: Are we creating a dedicated ElevenLabs agent, or managing the conversation ourselves via WebSocket + Claude?
- [ ] Blaxel persistence model: Using Blaxel sandboxes for state, or a separate Postgres? Need to decide.
- [ ] Scoring calibration: How do we validate that Claude's scores are consistent? Do we need a rubric fine-tuning pass?
- [ ] Persona realism: Should personas reference real market conditions (e.g., "the market just dropped 10%") or stay generic?
